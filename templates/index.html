{% extends "base.html" %}

{% block title %}
{% if bill %}{{ bill.title }} - TeenCivics{% else %}TeenCivics - Congressional Bills for Teens{% endif %}
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='tell-rep.css', v='2026-02-08-v1') }}">
{% endblock %}

{% block extra_js %}
<script defer src="{{ url_for('static', filename='tell-rep.js', v='2026-02-08-v1') }}"></script>
{% endblock %}

{% block content %}
<div class="hero-section" style="background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('/static/img/hero.png'); background-size: cover; background-position: center; color: white; padding: 6rem 0;">
    <div class="container">
        <h1>Congress Made Simple</h1>
        <p class="hero-subtitle" style="color: #f0f0f0;">Understand congressional bills through AI-powered summaries designed for teenagers</p>
    </div>
</div>

<div class="container">
    {% if bill %}
    <article class="bill-card featured-bill">
        <div class="bill-header">
            <h4 class="bill-title">{{ bill.title }}</h4>
        </div>

        <div class="bill-content">
            <!-- Term Dictionary Section -->
            <div class="term-dictionary-section">
                <h3>Term Dictionaries</h3>
                <div class="term-dictionary-content">
                    {# Hide term dictionary definitions for visual appeal - keep only educational resources #}
                    
                    <div class="term-resources">
                        <p><em>If you come across any unfamiliar words while reading, these resources can help make everything clearer. Pick whichever one works best for you!</em></p>
                        <ul>
                            <li><a href="https://www.congress.gov/help/legislative-glossary" target="_blank" rel="noopener">üìö Congress.gov Legislative Glossary</a> - Comprehensive congressional terms</li>
                            <li><a href="https://www.nvfc.org/glossary-of-congressional-terms/" target="_blank" rel="noopener">üìñ NVFC Congressional Terms Glossary</a> - Concise, easy-to-understand definitions</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="summary-section">
                <h3>Summary</h3>
                <div class="summary-text">
                    {% if bill.summary_overview or bill.summary_detailed %}
                        {% if bill.summary_overview %}
                            <p>{{ bill.summary_overview|e|replace('\n', '<br>')|safe }}</p>
                        {% endif %}
                        {% if bill.summary_detailed %}
                            <div>{{ bill.summary_detailed|format_detailed_html }}</div>
                        {% else %}
                            <div>{{ bill.summary_long|format_detailed_html }}</div>
                        {% endif %}
                    {% else %}
                        <div>{{ bill.summary_long|format_detailed_html }}</div>
                    {% endif %}
                </div>
            </div>

            <div class="bill-actions">
                <a href="{{ bill.bill_id|generate_congress_url(bill.congress_session) }}" target="_blank" rel="noopener" class="btn btn-primary">
                    Read Full Bill on Congress.gov
                </a>
                <a href="{{ url_for('bill_detail', slug=bill.website_slug) }}" class="btn btn-secondary">
                    View Bill Details
                </a>
                <div class="share-dropdown">
                    <button class="btn btn-share" aria-expanded="false" aria-haspopup="true">
                        Share This Bill
                    </button>
                    <div class="share-options" role="menu" aria-label="Share options">
                        <a href="https://twitter.com/intent/tweet?text={{ ('Check out this bill on @TeenCivics: ' ~ bill.title ~ '\n\n' ~ url_for('bill_detail', slug=bill.website_slug, _external=True))|urlencode }}"
                           target="_blank" rel="noopener" class="share-option share-x" role="menuitem">
                            <span class="share-icon" aria-hidden="true">ùïè</span> Share on X
                        </a>
                        <a href="https://bsky.app/intent/compose?text={{ ('Check out this bill on @teencivics.bsky.social: ' ~ bill.title ~ '\n\n' ~ url_for('bill_detail', slug=bill.website_slug, _external=True))|urlencode }}"
                           target="_blank" rel="noopener" class="share-option share-bluesky" role="menuitem">
                            <svg viewBox="0 0 568 501" fill="currentColor" aria-hidden="true" class="share-icon">
                                <path d="M123.121 33.664C188.241 82.553 258.281 181.68 284 234.873c25.719-53.192 95.759-152.32 160.879-201.21C491.866-1.611 568-28.906 568 57.947c0 17.346-9.945 145.713-15.778 166.555-20.275 72.453-94.155 90.933-159.875 79.748C507.222 323.8 536.444 388.56 473.333 453.32c-119.86 122.992-172.272-30.859-185.702-70.281-2.462-7.227-3.614-10.608-3.631-7.733-.017-2.875-1.169.506-3.631 7.733-13.43 39.422-65.842 193.273-185.702 70.281-63.111-64.76-33.89-129.52 80.986-149.071-65.72 11.185-139.6-7.295-159.875-79.748C10.945 203.66 1 75.293 1 57.947 1-28.906 76.134-1.611 123.121 33.664z"/>
                            </svg>
                            Share on Bluesky
                        </a>
                        <a href="https://www.threads.net/intent/post?text={{ ('Check out this bill on @teen.civics: ' ~ bill.title ~ '\n\n' ~ url_for('bill_detail', slug=bill.website_slug, _external=True))|urlencode }}"
                           target="_blank" rel="noopener" class="share-option share-threads" role="menuitem">
                            <span class="share-icon" aria-hidden="true">üßµ</span> Share on Threads
                        </a>
                        <button class="share-option share-copy" role="menuitem" data-url="{{ url_for('bill_detail', slug=bill.website_slug, _external=True) }}">
                            <span class="share-icon" aria-hidden="true">üîó</span> Copy Link
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Poll Widget -->
        <div class="poll-widget" data-bill-id="{{ bill.bill_id }}">
            <h3>What do you think about this bill?</h3>
            <p class="poll-subtitle">Vote to see who sponsored it!</p>
            <div class="poll-options">
                <button class="poll-option" data-vote="yes">
                    üëç Yes, support it
                </button>
                <button class="poll-option" data-vote="no">
                    üëé No, oppose it
                </button>
            </div>
            <div class="poll-message"></div>
            <div class="poll-results" style="display: none;" aria-live="polite">
                <h4>Community Results</h4>
                <div class="result-bar">
                    <div class="result-fill yes-fill" style="width: 0%">
                        <span class="result-label">Yes: <span class="result-count">0</span></span>
                    </div>
                </div>
                <div class="result-bar">
                    <div class="result-fill no-fill" style="width: 0%">
                        <span class="result-label">No: <span class="result-count">0</span></span>
                    </div>
                </div>
                <p class="total-votes">Total votes: <span class="votes-count">0</span></p>
            </div>
            
            <!-- Sponsor Section - Only visible after voting -->
            <div class="sponsor-reveal" id="sponsor-reveal-{{ bill.bill_id }}" style="display: none;">
                {% if bill.sponsor_name %}
                <div class="sponsor-info">
                    <p class="sponsor-sentence">{{ bill.sponsor_name|format_sponsor_sentence }}</p>
                </div>
                {% endif %}
            </div>

            <!-- Tell Your Rep ‚Äî appears after voting (hidden by default, shown via JS) -->
            <div class="tell-rep-container" style="display: none;">
                <div class="tell-rep-trigger" id="tell-rep-trigger-{{ bill.bill_id }}">
                    <button class="btn-tell-rep" data-bill-id="{{ bill.bill_id }}"
                            aria-expanded="false" aria-controls="tell-rep-section-{{ bill.bill_id }}">
                        <span class="btn-icon">üì£</span> Tell Your Rep How You Voted
                    </button>
                </div>

                <div class="tell-rep-section" id="tell-rep-section-{{ bill.bill_id }}"
                     data-bill-id="{{ bill.bill_id }}" data-bill-title="{{ bill.title }}">
                <h4>‚úâÔ∏è Make Your Voice Heard</h4>
                <p class="tell-rep-subtitle">Now that you've voted, tell your representative how you feel about this bill.</p>

                <div class="zip-lookup-group">
                    <div class="zip-input-wrapper">
                        <input type="text" class="zip-input" maxlength="5" pattern="[0-9]{5}"
                               placeholder="ZIP code" inputmode="numeric"
                               aria-label="Enter your 5-digit ZIP code">
                        <span class="zip-validation-icon" aria-hidden="true"></span>
                    </div>
                    <button class="btn btn-primary btn-find-rep" type="button">Find My Rep</button>
                </div>

                <div class="tell-rep-error" style="display: none;" role="alert"></div>

                <div class="tell-rep-loading" style="display: none;" aria-live="polite">
                    <div class="spinner"></div>
                    <span>Looking up your representative‚Ä¶</span>
                </div>

                    <div class="tell-rep-results" style="display: none;" aria-live="polite"></div>
                </div>
            </div>
        </div>

        <!-- Bill metadata moved to bottom -->
        <div class="bill-meta-bottom">
            <div class="meta-item">
                <span class="meta-label">Bill ID:</span>
                <span class="meta-value">{{ bill.bill_id }}</span>
            </div>
            <div class="meta-item">
                <span class="meta-label">Congress Session:</span>
                <span class="meta-value">{{ bill.congress_session or 'N/A' }}</span>
            </div>
            <div class="meta-item">
                <span class="meta-label">Date Processed:</span>
                <span class="meta-value">{{ bill.date_processed|format_datetime_simple }}</span>
            </div>
            <div class="meta-item">
                <span class="meta-label">Introduced:</span>
                <span class="meta-value">{{ bill.date_introduced or 'N/A' }}</span>
            </div>
            <div class="meta-item">
                <span class="meta-label">Status:</span>
                <span class="meta-value bill-status {{ (bill.normalized_status or 'unknown')|lower|replace('_', '-')|replace(' ', '-') }}">{{ bill.normalized_status|format_status or 'Unknown' }}</span>
            </div>
        </div>
    </article>
    {% else %}
    <div class="no-bills-message">
        <h2>No bills available yet</h2>
        <p>We're working on summarizing the latest congressional bills. Check back soon!</p>
        {% if error %}
        <p class="error-message">{{ error }}</p>
        {% endif %}
    </div>
    {% endif %}

    <div class="cta-section">
        <h2>Explore More Bills</h2>
        <p>Browse our archive of previously summarized bills and see how others voted.</p>
        <a href="{{ url_for('archive') }}" class="btn btn-primary">View Bill Archive</a>
    </div>

    <div class="features-section">
        <h2>Why TeenCivics?</h2>
        <div class="features-grid">
            <div class="feature-card">
                <span class="feature-emoji">üëë</span>
                <h3>Made for Teens</h3>
                <p>Complex bills explained in language you can actually understand.</p>
            </div>
            <div class="feature-card">
                <span class="feature-emoji">ü§ñ</span>
                <h3>AI-Powered</h3>
                <p>Advanced AI summarizes lengthy legislation into key points.</p>
            </div>
            <div class="feature-card">
                <span class="feature-emoji">üó≥Ô∏è</span>
                <h3>Your Voice Matters</h3>
                <p>Your opinions help shape laws. Vote, join the conversation, and make your voice count.</p>
            </div>
            <div class="feature-card">
                <span class="feature-emoji">üöÄ</span>
                <h3>Lead the Future</h3>
                <p>Learn how government works and gain tools to shape what comes next.</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}