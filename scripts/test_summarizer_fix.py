import unittest
import os
from src.processors.summarizer import summarize_bill_enhanced

class TestSummarizerFix(unittest.TestCase):
    def test_summarizer_uses_full_text(self):
        bill = {
            "bill_id": "hr2184-119",
            "title": "To enforce the requirement that the National Instant Criminal Background Check System make a final disposition of requests to correct its records within 60 days, and for other purposes.",
            "full_text": "H. R. 2184\n[Report No. 119–338]\n\n\nTo enforce the requirement that the National Instant Criminal Background Check System make a final disposition of requests to correct its records within 60 days, and for other purposes.\n\nIN THE HOUSE OF REPRESENTATIVES\nMarch 18, 2025\nMr. Emmer (for himself, Mr. Bean of Florida, Mr. Biggs of Arizona, Mr. Bost, Mr. Carter of Georgia, Mr. Collins, Mr. Donalds, Mr. Estes, Mr. Finstad, Mr. Fleischmann, Mr. Gosar, Mr. Norman, Ms. Tenney, Mr. Timmons, and Mr. Reschenthaler) introduced the following bill; which was referred to the Committee on the Judiciary\n\nOctober 3, 2025\nAdditional sponsors: Mr. Van Drew, Mr. Newhouse, Mr. Grothman, Mr. Mann, Mr. Barr, Mr. Rogers of Alabama, Mr. Calvert, Ms. Stefanik, Mrs. Fischbach, and Mr. Hamadeh of Arizona\n\nOctober 3, 2025\nReported with an amendment, committed to the Committee of the Whole House on the State of the Union, and ordered to be printed\n\n[Strike out all after the enacting clause and insert the part printed in italic]\n\n[For text of introduced bill, see copy of bill as introduced on March 18, 2025]\n\nA BILL\nTo enforce the requirement that the National Instant Criminal Background Check System make a final disposition of requests to correct its records within 60 days, and for other purposes.\n\nBe it enacted by the Senate and House of Representatives of the United States of America in Congress assembled,\n\nSECTION 1. SHORT TITLE.\n\nThis Act may be cited as the “Firearm Due Process Protection Act of 2025”.\n\nSEC. 2. ENFORCEMENT OF DEADLINE FOR FINAL DISPOSITION OF REQUESTS TO CORRECT RECORDS OF THE NATIONAL INSTANT CRIMINAL BACKGROUND CHECK SYSTEM; DUE PROCESS PROTECTIONS.\n\nSection 925A of title 18, United States Code, is amended—\n\n(1) by inserting “(a) In General.—” before “Any person”;\n\n(2) by inserting “or aggrieved by a violation of the penultimate sentence of section 103(g) of the Brady Handgun Violence Prevention Act” after “(s) or (t) of section 922”;\n\n(3) by striking the last sentence; and\n\n(4) by adding after and below the end the following:\n\n“(b) Procedural Rules.—\n\n“(1) EXPEDITED HEARING.—The court shall hold a hearing on an action brought under subsection (a), within 30 days after the action is brought.\n\n“(2) BURDEN OF PROOF.—At such a hearing, the respondent shall bear the burden of proving by clear and convincing evidence that the individual is ineligible to receive or possess a firearm.\n\n“(c) Remedies.—\n\n“(1) IN GENERAL.—The court shall assess against the respondent reasonable attorney fees and other litigation costs reasonably incurred in an action brought under subsection (a) in which the complainant has substantially prevailed.\n\n“(2) SUBSTANTIALLY PREVAILED.—For purposes of this section, a complainant has substantially prevailed if the complainant has obtained relief through—\n\n“(A) a judicial order;\n\n“(B) an enforceable written agreement or consent decree; or\n\n“(C) a voluntary or unilateral change in position by the United States, if the complainant’s claim is not insubstantial.”.\n\nSEC. 3. ANNUAL REPORTS TO THE CONGRESS ON DISPOSITION OF CHALLENGES TO ACCURACY OF RECORDS OF THE NATIONAL INSTANT CRIMINAL BACKGROUND CHECK SYSTEM.\n\nThe Director of the Federal Bureau of Investigation shall submit annually to the Committee on the Judiciary of the House of Representatives and the Committee on the Judiciary of the Senate a written report that specifies—\n\n(1) the total number of challenges to the accuracy of the records of the National Instant Criminal Background Check System (in this section referred to as the “NICS system”) established under section 103 of the Brady Handgun Violence Prevention Act that were received by the NICS system during the year covered by the report;\n\n(2) the total number of the challenges that were processed to final disposition by the NICS system;\n\n(3) the total number of the challenges with respect to which the initial determination of the NICS system was reversed, and with respect to those challenges, the total number in which each reason for the initial determination was made;\n\n(4) the total number of the challenges with respect to which the initial determination of the NICS system was not reversed, and with respect to those challenges, the total number in which each reason for not doing so was made; and\n\n(5) the average length of time needed to complete the processing of the challenges referred to in paragraph (2).\n\nSEC. 4. SENSE OF THE CONGRESS.\n\nIt is the sense of the Congress that—\n\n(1) the right of the people to keep and bear arms is a fundamental component of self-government, self-defense, and the preservation of individual liberty;\n\n(2) deprivation of the constitutional right to bear arms requires due process under the Fifth and Fourteenth Amendments to the Constitution of the United States;\n\n(3) ignoring appeals of determinations made by the National Instant Criminal Background Check System (NICS) violates due process; and\n\n(4) NICS should have the burden of showing a valid reason for the denial of this constitutional right."
        }

        summary = summarize_bill_enhanced(bill)

        # Check that the summary is not empty and contains details from the full text
        self.assertTrue(summary["overview"])
        self.assertTrue(summary["detailed"])
        self.assertIn("NICS", summary["detailed"])
        self.assertIn("expedited hearing", summary["detailed"])
        self.assertIn("remedies", summary["detailed"])

if __name__ == "__main__":
    unittest.main()